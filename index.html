<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *,
        ::after,
        ::before {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p {
            padding: 0;
            margin: 0;
        }

        ul,
        li,
        ol {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        body {
            background: rgb(111, 126, 122);
            color: black;
            font-size: 20px;
            line-height: 24px;
            font-weight: 500;
            font-family: Arial, sans-serif;
        }

        .modal-window {
            background: rgb(111, 126, 122);
            overflow: hidden;
            width: 100%;
            max-width: 700px;
            border-radius: 20px;
        }

        .container {
            margin: 0 auto;
            max-width: 630px;
            padding: 0 15px;
        }

        .modal-window__sections {
            margin-top: 30px;
            border-radius: 15px;
        }

        .modal-window__sections-title,
        .modal-window__random-title {
            font-size: 25px;
            margin-bottom: 20px;
            color: #fff;
        }

        .modal-window__sections-list {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
        }

        .modal-window__sections-list-item {
            margin-bottom: 20px;
            margin-right: 20px;
        }

        .modal-window__sections-list-item-btn {
            width: 100%;
            min-width: 90px;
            border: none;
            user-select: none;
            cursor: pointer;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            background: rgb(221, 36, 215);
            transition: all 0.2s ease-in-out;
        }

        .modal-window__sections-list-item-btn:hover {
            color: white;
            background: rgb(213, 94, 211);
        }

        .modal-window__sections-list-item:last-child {
            margin-bottom: 0;
        }

        .modal-window__sections-list-item-name {
            font-size: 15px;
            font-weight: 500;
            font-family: Arial, sans-serif;
            line-height: 24px;
        }

        /* =============================================== */
        /* modal random */
        .modal-window__random {
            display: none;
            border-radius: 20px;
        }

        .modal-window__random__active {
            display: block;
        }

        .modal-window__random-format-name {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
        }

        .modal-window__random-format-name__full,
        .modal-window__random-format-name__last-initials,
        .modal-window__random-format-name__last,
        .modal-window__random-format-name__middle,
        .modal-window__random-format-name__name-middle {
            margin-right: 20px;
            margin-bottom: 10px;
            font-size: 15px;
            border: none;
            user-select: none;
            cursor: pointer;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            background: rgb(26, 90, 122);
            transition: all 0.4s ease-in-out;
        }

        .modal-window__random-format-name__full:hover,
        .modal-window__random-format-name__last-initials:hover,
        .modal-window__random-format-name__last:hover,
        .modal-window__random-format-name__middle:hover,
        .modal-window__random-format-name__name-middle:hover {
            background: rgb(24, 67, 89);
        }

        .modal-window__random-language {
            display: flex;
            margin-bottom: 20px;
        }

        .modal-window__random-language__rus,
        .modal-window__random-language__eng {
            margin-right: 20px;
            font-size: 15px;
            border: none;
            user-select: none;
            cursor: pointer;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            background: rgb(26, 90, 122);
            transition: all 0.4s ease-in-out;
        }

        .modal-window__random-language__rus:hover,
        .modal-window__random-language__eng:hover {
            background: rgb(24, 67, 89);
        }

        .modal-window__random-format {
            display: flex;
            margin-bottom: 20px;
        }

        .modal-window__random-format__long,
        .modal-window__random-format__short,
        .modal-window__random-format__random {
            margin-right: 20px;
            font-size: 15px;
            border: none;
            user-select: none;
            cursor: pointer;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            background: rgb(26, 90, 122);
            transition: all 0.4s ease-in-out;
        }

        .modal-window__random-format__long:hover,
        .modal-window__random-format__short:hover,
        .modal-window__random-format__random:hover {
            background: rgb(24, 67, 89);
        }

        .modal-window__random-gender {
            display: flex;
            margin-bottom: 20px;
        }

        .modal-window__random-gender__male,
        .modal-window__random-gender__woman {
            margin-right: 20px;
            font-size: 15px;
            border: none;
            user-select: none;
            cursor: pointer;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            background: rgb(26, 90, 122);
            transition: all 0.4s ease-in-out;
        }

        .modal-window__random-gender__male:hover,
        .modal-window__random-gender__woman:hover {
            background: rgb(24, 67, 89);
        }

        .modal-window__random-transform {
            display: flex;
            margin-bottom: 20px;
        }

        .modal-window__random-transform__upper,
        .modal-window__random-transform__lower,
        .modal-window__random-transform__default {
            margin-right: 20px;
            font-size: 15px;
            border: none;
            user-select: none;
            cursor: pointer;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            background: rgb(26, 90, 122);
            transition: all 0.4s ease-in-out;
        }

        .modal-window__random-transform__upper:hover,
        .modal-window__random-transform__lower:hover,
        .modal-window__random-transform__default:hover {
            background: rgb(24, 67, 89);
        }

        .modal-window__random-sort {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .modal-window__random-sort__title {
            display: block;
            width: 100%;
        }

        .modal-window__random-sort__default,
        .modal-window__random-sort__alphabet {
            display: block;
            margin-right: 20px;
            font-size: 15px;
            border: none;
            user-select: none;
            cursor: pointer;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            background: rgb(26, 90, 122);
            transition: all 0.4s ease-in-out;
        }

        .modal-window__random-sort__default:hover,
        .modal-window__random-sort__alphabet:hover {
            background: rgb(24, 67, 89);
        }
    </style>
</head>

<body>

    <div class="modal-window">
        <div class="container">
            <div class="modal-window__sections">
                <h1 class="modal-window__sections-title">General sections</h1>
                <ul class="modal-window__sections-list">
                    <li class="modal-window__sections-list-item" id="name">
                        <button class="modal-window__sections-list-item-btn" data-section="name">
                            <p class="modal-window__sections-list-item-name">Имя</p>
                        </button>
                    </li>
                    <li class="modal-window__sections-list-item">
                        <button class="modal-window__sections-list-item-btn" data-section="address">
                            <p class="modal-window__sections-list-item-name">Адреса</p>
                        </button>
                    </li>
                </ul>
            </div>


            <div class="modal-window__random" id="modalRandom">
                <h2 class="modal-window__random-title">Random Sections</h2>

                <div class="modal-window__random-format-name">
                    <button class="modal-window__random-format-name__full" data-formatName="full">Фамилия Имя
                        Отчество</button>
                    <button class="modal-window__random-format-name__last-initials"
                        data-formatName="lastInitials">Фамилия
                        И.О.</button>
                    <button class="modal-window__random-format-name__last" data-formatName="last">Фамилия</button>
                    <button class="modal-window__random-format-name__last" data-formatName="first">Имя</button>
                    <button class="modal-window__random-format-name__middle" data-formatName="middle">Отчество</button>
                    <button class="modal-window__random-format-name__name-middle" data-formatName="nameMiddle">Имя
                        Отчество</button>
                </div>

                <div class="modal-window__random-transform">
                    <button class="modal-window__random-transform__upper" data-transform="upper">ЗАГЛАВНЫЕ</button>
                    <button class="modal-window__random-transform__lower" data-transform="lower">строчные</button>
                    <button class="modal-window__random-transform__default" data-transform="default">
                        По умолчанию
                    </button>
                </div>

                <div class="modal-window__random-sort">
                    <p class="modal-window__random-sort__title">Сортировать</p>
                    <button class="modal-window__random-sort__default" data-sort="default">По умолчанию</button>
                    <button class="modal-window__random-sort__alphabet" data-sort="alphabet">В алфавитном</button>
                </div>

                <div class="modal-window__random-language">
                    <button class="modal-window__random-language__rus" data-lang="rus">Русское</button>
                    <button class="modal-window__random-language__eng" data-lang="eng">Английское</button>
                </div>

                <div class="modal-window__random-gender">
                    <button class="modal-window__random-gender__male" data-gender="male">Мужское</button>
                    <button class="modal-window__random-gender__woman" data-gender="woman">Женское</button>
                </div>

                <div class="modal-window__random-format">
                    <button class="modal-window__random-format__long" data-length="long">Длинное</button>
                    <button class="modal-window__random-format__short" data-length="short">Короткое</button>
                    <button class="modal-window__random-format__random" data-length="random">Рандомно</button>
                </div>

            </div>

        </div>
    </div>

    <script>
        // modal-random, btn-sections, btn[data-section]
        const modalRandom = document.getElementById('modalRandom');
        const sectionBtn = document.querySelectorAll('.modal-window__sections-list-item-btn');
        const dataSection = document.querySelectorAll('[data-section]');

        // section Random
        const dataNameFormat = document.querySelectorAll('[data-formatName]');
        const dataLang = document.querySelectorAll('[data-lang]');
        const dataLength = document.querySelectorAll('[data-length]');
        const dataGender = document.querySelectorAll('[data-gender]');
        const dataTransform = document.querySelectorAll('[data-transform]');
        const dataSort = document.querySelectorAll('[data-sort]');


        const namesData = {
            rus: {
                male: {
                    long: {
                        firstNames: [
                            "Константин", "Александр", "Владислав", "Николай", "Станислав", "Дмитрий", "Иван", "Петр", "Максим", "Артем",
                            "Евгений", "Роман", "Виктор", "Григорий", "Юрий", "Анатолий", "Сергей", "Михаил", "Алексей", "Тимофей"
                        ],
                        lastNames: [
                            "Константинов", "Александров", "Владиславов", "Николаев", "Станиславов", "Петров", "Иванов", "Максимов", "Артемов",
                            "Евгеньев", "Романов", "Викторов", "Григорьев", "Юрьев", "Анатольев", "Сергеев", "Михайлов", "Алексеев", "Тимофеев"
                        ],
                        middleNames: [
                            "Константинович", "Александрович", "Владиславович", "Николаевич", "Станиславович", "Петрович", "Иванович", "Максимович",
                            "Артемович", "Евгеньевич", "Романович", "Викторович", "Григорьевич", "Юрьевич", "Анатольевич", "Сергеевич", "Михайлович",
                            "Алексеевич", "Тимофеевич"
                        ]
                    },
                    short: {
                        firstNames: [
                            "Ян", "Илья", "Макс", "Лев", "Егор", "Даня", "Гоша", "Коля", "Тимур", "Рома", "Саша", "Семен", "Паша", "Андрей"
                        ],
                        lastNames: [
                            "Петров", "Цак", "Миронов", "Соколов", "Иванов", "Лебедев", "Кузнецов", "Смирнов", "Попов", "Ковалев"
                        ],
                        middleNames: [
                            "Петрович", "Цакович", "Миронович", "Соколович", "Иванович", "Лебедевич", "Кузнецович", "Смирнович", "Попович", "Ковалевич"
                        ]
                    }
                },
                woman: {
                    long: {
                        firstNames: [
                            "Александра", "Валентина", "Екатерина", "Елизавета", "Светлана", "Дарина", "Ольга", "Мария", "Татьяна", "Ирина",
                            "Анастасия", "Виктория", "Наталья", "Юлия", "Галина", "Ксения", "Людмила", "Нина", "Алла", "Елена"
                        ],
                        lastNames: [
                            "Александрова", "Валентинова", "Екатерининская", "Елизаветина", "Светланова", "Петрова", "Миронова", "Козлова",
                            "Смирнова", "Иванова", "Попова", "Лебедева", "Кузнецова", "Соколова", "Жукова", "Калинина", "Григорьева", "Михайлова"
                        ],
                        middleNames: [
                            "Александровна", "Валентиновна", "Екатериновна", "Елизаветовна", "Светлановна", "Петровна", "Мироновна", "Козловна",
                            "Смирновна", "Ивановна", "Поповна", "Лебедева", "Кузнецова", "Соколова", "Жуковна", "Калинина", "Григорьевна", "Михайловна"
                        ]
                    },
                    short: {
                        firstNames: [
                            "Аня", "Лена", "Юля", "Ира", "Зоя", "Нина", "Оля", "Ксюша", "Катя", "Таня", "Маша", "Алла", "Наташа"
                        ],
                        lastNames: [
                            "Петрова", "Цакова", "Миронова", "Соколова", "Иванова", "Попова", "Кузнецова", "Лебедева", "Тихонова", "Шевченко"
                        ],
                        middleNames: [
                            "Петровна", "Цаковна", "Мироновна", "Соколовна", "Ивановна", "Поповна", "Лебедева", "Кузнецова", "Шевченкова", "Тихонова"
                        ]
                    }
                }
            },
            eng: {
                male: {
                    long: {
                        firstNames: [
                            "Alexander", "Christopher", "Nathaniel", "Benjamin", "Sebastian", "Matthew", "William", "Joseph", "Edward", "Samuel",
                            "John", "Henry", "George", "Charles", "David", "James", "Mark", "Daniel", "Thomas", "Luke"
                        ],
                        lastNames: [
                            "Alexander", "Johnson", "Washington", "Henderson", "McAllister", "Smith", "Adams", "Bennett", "Carter", "Evans",
                            "Mitchell", "Turner", "Walker", "Young", "King", "Scott", "Gray", "Hill", "Green", "White"
                        ]
                    },
                    short: {
                        firstNames: [
                            "Tom", "Max", "Ian", "Leo", "Ben", "John", "Jake", "Sam", "Mark", "Dan"
                        ],
                        lastNames: [
                            "Smith", "Jones", "Brown", "White", "Miller", "Davis", "Clark", "Evans", "Hall", "Moore"
                        ]
                    }
                },
                woman: {
                    long: {
                        firstNames: [
                            "Elizabeth", "Catherine", "Victoria", "Madeline", "Alexandra", "Sarah", "Emily", "Rebecca", "Alice", "Charlotte",
                            "Eleanor", "Amelia", "Sophia", "Isabella", "Abigail", "Lillian", "Grace", "Olivia", "Megan", "Hannah"
                        ],
                        lastNames: [
                            "Johnson", "Harrison", "McArthur", "Fitzgerald", "Winchester", "Thompson", "Davis", "Miller", "Martinez", "Anderson",
                            "Rodriguez", "Brown", "Wilson", "Moore", "Clark", "Scott", "Evans", "King", "Allen", "Mitchell"
                        ]
                    },
                    short: {
                        firstNames: [
                            "Amy", "Jane", "Emma", "Ivy", "Mia", "Sophie", "Lily", "Chloe", "Zoe", "Lucy"
                        ],
                        lastNames: [
                            "Smith", "Jones", "Brown", "Davis", "Clark", "Evans", "Wilson", "Harris", "Martin", "Lopez"
                        ]
                    }
                }
            },
            formats: {
                full: (firstName, lastName, middleName) => `${lastName} ${firstName} ${middleName}`,
                lastInitials: (firstName, lastName, middleName) => `${lastName} ${firstName[0]}.${middleName[0]}.`,
                last: (lastName) => lastName,
                first: (firstName) => firstName,
                nameMiddle: (firstName, middleName) => `${firstName} ${middleName}`,
                middle: (middleName) => `${middleName}`
            },
        };

        const randomSettings = {
            formatName: 'last',
            transform: "default",
            sort: "default",
            lang: "rus",
            length: "long",
            gender: "male",
        };

        // open modal window
        sectionBtn.forEach((btn) => {
            btn.addEventListener('click', () => {
                parent.postMessage({ pluginMessage: { type: 'block' } }, '*');
                const section = btn.getAttribute('data-section');
                if (section === "name") {
                    modalRandom.classList.add('modal-window__random__active');
                }
            });
        });

        // buttons added parameters for objects

        dataNameFormat.forEach(btn => {
            btn.addEventListener('click', () => {
                const formatName = btn.getAttribute('data-formatName');
                randomSettings.formatName = formatName;
                sendUpdatedSettings();
                updateNameInFigma();
            });
        });

        dataLang.forEach(btn => {
            btn.addEventListener('click', () => {
                const changeLang = btn.getAttribute('data-lang');
                randomSettings.lang = changeLang;
                sendUpdatedSettings();
                updateNameInFigma();
            });
        });

        dataLength.forEach(btn => {
            btn.addEventListener('click', () => {
                randomSettings.length = btn.getAttribute('data-length');
                sendUpdatedSettings();
                updateNameInFigma()
            });
        });

        dataGender.forEach(btn => {
            btn.addEventListener('click', () => {
                randomSettings.gender = btn.getAttribute('data-gender');
                sendUpdatedSettings();
                updateNameInFigma()
            });
        });

        dataTransform.forEach(btn => {
            btn.addEventListener('click', () => {
                randomSettings.transform = btn.getAttribute('data-transform');
                sendUpdatedSettings();
                updateNameInFigma();
            });
        });


        dataSort.forEach((btn) => {
            btn.addEventListener('click', () => {
                const sortType = btn.getAttribute('data-sort');
                sendSortCommand(sortType);
            });
        });



        // functions for plugin 

        function sendSortCommand(sortType) {
            parent.postMessage({
                pluginMessage: {
                    type: 'sortSelected',
                    sort: sortType,
                }
            }, '*');
        }

        function sendUpdatedSettings() {
            parent.postMessage({
                pluginMessage: {
                    type: 'updateSettings',
                    settings: { ...randomSettings }
                }
            }, '*');
        }

        function updateNameInFigma() {
            const generatedName = generateName(randomSettings);
            parent.postMessage({
                pluginMessage: {
                    type: 'updateText',
                    content: generatedName
                }
            }, '*');
        }

        function hideBlockLanguage() {
            if (randomSettings.lang === "eng") {
                const formatsToHide = ["full", "lastInitials", "nameMiddle", "middle"];
                dataNameFormat.forEach((block) => {
                    const formatName = block.getAttribute('data-formatName');
                    if (formatsToHide.includes(formatName)) {
                        block.style.display = "none";
                    }
                });
            } else {
                dataNameFormat.forEach((block) => {
                    block.style.display = "block";
                });
            }
        };

        function changeTransformText(text, transform) {
            switch (transform) {
                case 'upper':
                    return text.toUpperCase();
                case 'lower':
                    return text.toLowerCase();
                case 'default':
                    return text.charAt(0) + text.slice(1);
                default:
                    return text;
            };
        };

        function hideBlockLanguage() {
            if (randomSettings.lang === "eng") {
                const formatsToHide = ["full", "lastInitials", "nameMiddle", "middle"];
                dataNameFormat.forEach((block) => {
                    const formatName = block.getAttribute('data-formatName');
                    if (formatsToHide.includes(formatName)) {
                        block.style.display = "none";
                    } else {
                        block.style.display = "block";
                    }
                });
            } else {
                dataNameFormat.forEach((block) => {
                    block.style.display = "block";
                });
            }
        }

        function generateName(settings) {
            const { lang, gender, length, formatName, transform, sort } = settings;
            hideBlockLanguage()
            const lengthType = length === "random" ? (Math.random() > 0.5 ? "long" : "short") : length;

            let names;
            if (namesData[lang] && namesData[lang][gender] && namesData[lang][gender][lengthType]) {
                names = namesData[lang][gender][lengthType];
            } else {
                return "Ошибка генерации имени";
            }

            if (sort === "alphabet") {
                if (names.firstNames) names.firstNames.sort();
                if (names.lastNames) names.lastNames.sort();
                if (names.middleNames) names.middleNames.sort();
            }

            if (!names.lastNames || names.lastNames.length === 0) {
                return "Ошибка: нет фамилий";
            }

            const firstName = names.firstNames[Math.floor(Math.random() * names.firstNames.length)];
            const lastName = names.lastNames[Math.floor(Math.random() * names.lastNames.length)];
            const middleName = names.middleNames
                ? names.middleNames[Math.floor(Math.random() * names.middleNames.length)]
                : '';


            if (!namesData.formats[formatName]) {
                return "Ошибка: неизвестный формат";
            }


            let fullName = '';
            if (formatName === 'last') {
                fullName = namesData.formats[formatName](lastName);
            } else if (formatName === 'middle') {
                fullName = namesData.formats[formatName](middleName);
            } else {
                fullName = namesData.formats[formatName](firstName, lastName, middleName);
            }

            return changeTransformText(fullName, transform);
        }


    </script>
</body>

</html>